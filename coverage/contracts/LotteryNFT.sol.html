<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\LotteryNFT.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> LotteryNFT.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">28.57% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>12/42</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">9.09% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>2/22</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">28.57% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>4/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">30.43% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>14/46</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
&nbsp;
pragma solidity &gt;=0.5.0 &lt;0.8.0;
&nbsp;
//import "github.com/OpenZeppelin/openzeppelin-solidity/contracts/token/ERC721/ERC721.sol";
&nbsp;
import "./contracts/token/ERC721/ERC721.sol";
&nbsp;
contract LotteryNFT is ERC721("LotteryNGF", "LNFT"){
    
    enum ticketStatus {FOR_SALE, SOLD, DESTROY}
    uint private randNonce = 0;
    string public dateLottery;
	uint256 public priceLottery;
	address public manager = msg.sender;
	
    struct TicketLottery{
        uint256 id;
        uint256 price;
        string date;
        ticketStatus status;
        address payable manager;
        address payable owner;
    }
&nbsp;
    enum Phase {Init, Sale, Draw}
    Phase public state= Phase.Init;
    
    TicketLottery [] public ticketsLottery;
    
    mapping(uint256 =&gt; TicketLottery) public tokens;
    
    /*constructor(){
		manager = msg.sender;
		state = Phase.Init;
	}*/
&nbsp;
	
<span class="fstat-no" title="function not covered" >    modifier validStatus(ticketStatus _status, uint256 _tokenId) {</span>
<span class="cstat-no" title="statement not covered" >        TicketLottery memory ticketLottery = tokens[_tokenId];</span>
<span class="cstat-no" title="statement not covered" >        require(ticketLottery.status == _status)</span>;
        _;
    }
    
<span class="fstat-no" title="function not covered" >    modifier onlyOwner(uint256 _tokenId){</span>
<span class="cstat-no" title="statement not covered" >        require(msg.sender == (super.ownerOf(_tokenId)), "No owner of the Token")</span>;
        _;
    }
    
    modifier onlyManager() {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(msg.sender  == manager,"Your not the manager");
        _;
    }
    
    modifier validPhase(Phase reqPhase) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(state == reqPhase);
        _;
    }
	
	function initLottery(string memory _dateLottery, uint256 _priceLottery)public validPhase(Phase.Init) onlyManager{
	    dateLottery = _dateLottery;
		priceLottery = _priceLottery;
		state = Phase.Sale;
	}
	
<span class="fstat-no" title="function not covered" >	function changeState(Phase x) public onlyManager {</span>
<span class="cstat-no" title="statement not covered" >        require(x &gt; state)</span>;
<span class="cstat-no" title="statement not covered" >        state = x</span>;
    }
   
    function createTicketLottery() public validPhase(Phase.Sale) onlyManager {
        TicketLottery memory _ticketLottery = TicketLottery ({
            id : 0,
            price: priceLottery,
            date: dateLottery,
            status: ticketStatus.FOR_SALE, 
            manager:msg.sender,
            owner:msg.sender
        });
        
        ticketsLottery.push(_ticketLottery);
        uint256 tokenId = ticketsLottery.length - 1;
        _safeMint(msg.sender, tokenId);
        uint _index = tokenOfOwnerByIndex(msg.sender, tokenId);
        ticketsLottery[_index].id = _index;
        tokens[tokenId]=_ticketLottery;
     }
     
<span class="fstat-no" title="function not covered" >     function approveTransferToken(address _attendee, uint256 _tokenId) public onlyOwner(_tokenId) validStatus(ticketStatus.FOR_SALE, _tokenId){</span>
<span class="cstat-no" title="statement not covered" >         TicketLottery memory consultingService= tokens[_tokenId];</span>
<span class="cstat-no" title="statement not covered" >         super.approve(_attendee, _tokenId)</span>;
<span class="cstat-no" title="statement not covered" >         emit Approval(consultingService.owner, _attendee, _tokenId);</span>
     }
     
<span class="fstat-no" title="function not covered" >     function approvalForAll(address _attendee) public{</span>
<span class="cstat-no" title="statement not covered" >         require(_attendee != address(0x0))</span>;
<span class="cstat-no" title="statement not covered" >         super.setApprovalForAll(_attendee, true)</span>;
<span class="cstat-no" title="statement not covered" >         emit ApprovalForAll(msg.sender, _attendee, true);</span>
     }
     
<span class="fstat-no" title="function not covered" >     function validateIsApprovedForAll(address _attendee) public returns(bool){</span>
         
     }
     
<span class="fstat-no" title="function not covered" >     function existsToken(uint256 _tokenId) internal view returns(bool) {</span>
<span class="cstat-no" title="statement not covered" >        return (!(tokens[_tokenId].price == 0));</span>
     }
    
<span class="fstat-no" title="function not covered" >     function buyTicketLottery(uint256 _tokenId) payable public validStatus(ticketStatus.FOR_SALE, _tokenId) validPhase(Phase.Sale) </span>
     {
<span class="cstat-no" title="statement not covered" >            require(existsToken(_tokenId),"TicketLottery: nonexistant token")</span>;
<span class="cstat-no" title="statement not covered" >            TicketLottery memory ticketLottery= tokens[_tokenId];</span>
<span class="cstat-no" title="statement not covered" >            uint256 index = ticketLottery.id;</span>
<span class="cstat-no" title="statement not covered" >            require(super.getApproved(_tokenId) == msg.sender, "Your are not the owner")</span>;
<span class="cstat-no" title="statement not covered" >            require(msg.value &gt;= ticketLottery.price, "Balance less than the price")</span>;
<span class="cstat-no" title="statement not covered" >            require(msg.sender != address(0), "Addres invalid")</span>;
<span class="cstat-no" title="statement not covered" >            if(msg.value &gt; ticketLottery.price){</span>
<span class="cstat-no" title="statement not covered" >                msg.sender.transfer(msg.value - ticketLottery.price)</span>;
            }
<span class="cstat-no" title="statement not covered" >            ticketLottery.owner.transfer(ticketLottery.price)</span>;
<span class="cstat-no" title="statement not covered" >            super.transferFrom(ticketLottery.owner, msg.sender, _tokenId)</span>;
<span class="cstat-no" title="statement not covered" >            emit Transfer(ticketLottery.owner, msg.sender, _tokenId);</span>
<span class="cstat-no" title="statement not covered" >            ticketsLottery[index].owner =msg.sender</span>;
<span class="cstat-no" title="statement not covered" >            ticketsLottery[index].status = ticketStatus.SOLD</span>;
     }
     
<span class="fstat-no" title="function not covered" >     function closeSale() public validPhase(Phase.Sale) onlyManager{</span>
<span class="cstat-no" title="statement not covered" >         state = Phase.Draw</span>;
     }
     
<span class="fstat-no" title="function not covered" >     function pickWinner() public onlyManager validPhase(Phase.Draw) returns(address, uint256) {</span>
<span class="cstat-no" title="statement not covered" >         uint numTickets = ticketsLottery.length;</span>
<span class="cstat-no" title="statement not covered" >         uint256 tokenWinner = uint(keccak256(abi.encodePacked(block.timestamp, msg.sender, randNonce))) % numTickets; </span>
<span class="cstat-no" title="statement not covered" >         state = Phase.Init</span>;
<span class="cstat-no" title="statement not covered" >         return (ownerOf(tokenWinner), tokenWinner);</span>
     }
     
     
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Jan 31 2021 08:06:27 GMT-0500 (Eastern Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
